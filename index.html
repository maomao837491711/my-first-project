<!DOCTYPE html>  
<html lang="zh-CN">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">  
    <title>åŠ å¯†è´§å¸å‘¨æœŸç›‘æ§</title>  
    <!-- å›¾æ ‡ -->  
    <link rel="icon" href="https://maomao837491711.github.io/jianban/jianbanlogo2.png">  
    <link rel="apple-touch-icon" sizes="180x180" href="https://maomao837491711.github.io/jianban/jianbanlogo2.png">  
    <!-- Web App -->  
    <meta name="apple-mobile-web-app-capable" content="yes">  
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">  
    <meta name="apple-mobile-web-app-title" content="å‘¨æœŸç›‘æ§">  
    <meta name="theme-color" content="#0d1117">  
  
    <style>  
        :root { --bg: #0d1117; --card: #161b22; --text: #c9d1d9; --btc: #f7931a; --ltc: #345d9d; --bull: #238636; --bear: #da3633; --gold: #d29922; --border: #30363d; }  
        * { box-sizing: border-box; }  
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; padding-top: max(15px, env(safe-area-inset-top)); }  
        h1 { text-align: center; font-size: 1.4rem; margin: 10px 0 15px; text-transform: uppercase; }  
        .container { width: 100%; max-width: 600px; gap: 15px; display: flex; flex-direction: column; }  
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; position: relative; overflow: hidden; }  
        .prediction-card { border: 1px solid rgba(210, 153, 34, 0.3); background: linear-gradient(180deg, rgba(210, 153, 34, 0.08) 0%, rgba(22, 27, 34, 1) 100%); }  
        .pred-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.06); align-items: center; }  
        .pred-row:last-child { border-bottom: none; }  
        .pred-label { color: #8b949e; font-size: 0.9rem; }  
        .pred-value { font-family: monospace; font-weight: 600; font-size: 1rem; }  
        .dynamic-row { background: rgba(255,255,255,0.02); margin: 0 -20px; padding: 12px 20px; border-bottom: 1px solid rgba(255,255,255,0.05); }  
        .coin-header { display: flex; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 12px; }  
        .coin-name { font-size: 1.3rem; font-weight: 700; color: #fff; }  
        .coin-symbol { font-size: 0.9rem; background: #30363d; padding: 4px 8px; border-radius: 6px; color: white; }  
        .info-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.95rem; }  
        .progress-container { margin-top: 15px; background: #21262d; border-radius: 10px; height: 8px; overflow: hidden; }  
        .progress-bar { height: 100%; border-radius: 10px; transition: width 1s ease; }  
        .countdown-box { background: rgba(13, 17, 23, 0.6); margin-top: 15px; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid #30363d; }  
        .timer { font-size: 1.8rem; font-weight: 800; font-family: monospace; color: #58a6ff; margin: 5px 0; }  
        .cache-badge { font-size: 0.7rem; background: #30363d; color: #8b949e; padding: 2px 6px; border-radius: 4px; margin-left: 5px; display: none; }  
        .refresh-btn { margin-top: 25px; padding: 16px 25px; background: #238636; color: white; border: none; border-radius: 12px; font-size: 1.05rem; font-weight: 600; cursor: pointer; width: 100%; max-width: 600px; margin-bottom: 10px; }  
        .refresh-btn:disabled { background: #30363d; color: #8b949e; }  
        .auto-refresh-tip { font-size: 12px; color: #484f58; margin-bottom: 40px; text-align: center; }  
          
        .card.btc::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background-color: var(--btc); }  
        .card.ltc::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background-color: var(--ltc); }  
        .bull-val { color: var(--bull); } .bear-val { color: var(--bear); } .gold-val { color: var(--gold); } .price-diff { color: #ff7b72; font-weight: bold; }  
    </style>  
</head>  
<body>  
    <h1>ğŸ“Š å¸‚åœºå‘¨æœŸç›‘æ§</h1>  
    <div class="container">  
        <div class="card prediction-card">  
            <div class="coin-header" style="border-bottom:none; margin-bottom:5px;">  
                <span style="color:var(--gold); font-weight:bold;">ğŸ”® å‘¨æœŸé¢„æµ‹</span>  
                <span style="font-size:0.85rem; color:#8b949e;" id="today-date">--/--</span>  
            </div>  
            <div class="pred-row"><span class="pred-label">ğŸ‚ ç‰›å¸‚é¡¶ç‚¹æ—¥æœŸ</span><span class="pred-value bull-val">2025-10-06</span></div>  
            <div class="pred-row"><span class="pred-label">ğŸ» ç†Šå¸‚ä½ç‚¹æ—¥æœŸ</span><span class="pred-value bear-val">2026-10-05</span></div>  
            <div class="pred-row"><span class="pred-label">ğŸ“ˆ æœ¬è½®ç‰›å¸‚æœ€é«˜ä»·</span><span class="pred-value gold-val">126,199 U</span></div>  
            <div class="pred-row"><span class="pred-label">ğŸ“‰ é¢„æµ‹ç†Šå¸‚ä½ç‚¹</span><span class="pred-value bear-val">38,000 U</span></div>  
            <div class="pred-row dynamic-row"><span class="pred-label" id="peak-label">è·ç¦»ç‰›å¸‚é¡¶ç‚¹è¿˜æœ‰</span><span class="pred-value" style="color:#fff;" id="peak-days">--</span></div>  
            <div class="pred-row dynamic-row"><span class="pred-label">è·ç¦»ç†Šå¸‚ä½ç‚¹è¿˜æœ‰</span><span class="pred-value bear-val" id="bear-days">--</span></div>  
            <div class="pred-row dynamic-row" style="border-bottom:none;">  
                <span class="pred-label">è·ç¦»æœ€ä½ç‚¹è¿˜å·® <span id="price-cached" class="cache-badge">ç¼“å­˜</span></span>  
                <span class="pred-value price-diff" id="price-gap">è¿æ¥ä¸­...</span>  
            </div>  
        </div>  
        <div id="app"></div>  
    </div>  
    <div><button class="refresh-btn" onclick="manualRefresh()">ğŸ”„ åˆ·æ–°æ•°æ®</button><div class="auto-refresh-tip">åŒçº¿è·¯è‡ªåŠ¨åˆ‡æ¢ | æ¯ 10 åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°</div></div>  
  
    <script>  
        // === å¤šçº¿è·¯è¯·æ±‚å™¨ (æ ¸å¿ƒ) ===  
        async function fetchWithFallback(urls) {  
            const ts = new Date().getTime();  
            for (let url of urls) {  
                try {  
                    const finalUrl = url.includes('?') ? `$${url}&t=$${ts}` : `$${url}?t=$${ts}`;  
                    const controller = new AbortController();  
                    setTimeout(() => controller.abort(), 4000); // 4ç§’è¶…æ—¶  
                    const res = await fetch(finalUrl, { signal: controller.signal });  
                    if (res.ok) return await res.json();  
                } catch (e) { continue; } // å¤±è´¥åˆ™å°è¯•ä¸‹ä¸€ä¸ª  
            }  
            throw new Error("All APIs failed");  
        }  
  
        // === 1. æ—¥æœŸé€»è¾‘ ===  
        function updateDateInfo() {  
            const now = new Date();  
            document.getElementById('today-date').innerText = "ä»Šå¤©: " + now.toLocaleDateString('zh-CN');  
              
            const bullDate = new Date("2025-10-06");  
            const diffBull = Math.ceil((bullDate - now) / 86400000);  
            const peakLabel = document.getElementById('peak-label');  
            const peakValue = document.getElementById('peak-days');  
  
            if (diffBull > 0) {  
                peakLabel.innerText = "è·ç¦»ç‰›å¸‚é¡¶ç‚¹è¿˜æœ‰"; peakLabel.style.color = "#8b949e";  
                peakValue.innerText = `${diffBull} å¤©`; peakValue.style.color = "#3fb950";  
            } else {  
                peakLabel.innerText = "è·ç¦»ç‰›å¸‚é¡¶ç‚¹å·²è¿‡"; peakLabel.style.color = "#d29922";   
                peakValue.innerText = `${Math.abs(diffBull)} å¤©`; peakValue.style.color = "#fff";  
            }  
              
            const bearDate = new Date("2026-10-05");  
            const diffBear = Math.ceil((bearDate - now) / 86400000);  
            document.getElementById('bear-days').innerText = diffBear > 0 ? `$${diffBear} å¤©` : `å·²è¿‡ $${Math.abs(diffBear)} å¤©`;  
        }  
  
        // === 2. ä»·æ ¼é€»è¾‘ (å¤šæºå¤‡ç”¨) ===  
        async function updatePriceGap() {  
            const BULL_PEAK = 126199; const BEAR_LOW = 38000;  
            const gapEl = document.getElementById('price-gap');  
            const badge = document.getElementById('price-cached');  
            let price = 0;  
  
            // ä»·æ ¼æºï¼šBinance -> Mempool -> CoinGecko  
            const apis = [  
                'https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT',  
                'https://mempool.space/api/v1/prices',  
                'https://api.coincap.io/v2/assets/bitcoin'  
            ];  
  
            try {  
                const data = await fetchWithFallback(apis);  
                // é€‚é…ä¸åŒAPIçš„æ•°æ®æ ¼å¼  
                if (data.price) price = parseFloat(data.price); // Binance  
                else if (data.USD) price = parseFloat(data.USD); // Mempool  
                else if (data.data && data.data.priceUsd) price = parseFloat(data.data.priceUsd); // CoinCap  
                  
                localStorage.setItem('btc_price', JSON.stringify({t:Date.now(), v:price}));  
                badge.style.display = 'none';  
            } catch (e) {  
                const c = JSON.parse(localStorage.getItem('btc_price'));  
                if (c) { price = c.v; badge.style.display = 'inline-block'; }  
                else { gapEl.innerText = "API å¿™ç¢Œ"; return; }  
            }  
  
            const diff = Math.floor(price - BEAR_LOW);  
            gapEl.innerText = diff > 0 ? `${diff.toLocaleString()} U` : `å·²è·Œç ´!`;  
        }  
  
        // === 3. åŒºå—æ•°æ® (å¤šæºå¤‡ç”¨) ===  
        const COINS = [  
            {   
                id: 'btc', name: 'Bitcoin', symbol: 'BTC',   
                halving: 1050000, last: 840000, time: 600,  
                // BTCæºï¼šMempool -> Blockchain.info -> Blockchair  
                apis: ['https://mempool.space/api/blocks/tip/height', 'https://blockchain.info/q/getblockcount']  
            },  
            {   
                id: 'ltc', name: 'Litecoin', symbol: 'LTC',   
                halving: 3360000, last: 2520000, time: 150,  
                // LTCæºï¼šBlockCypher -> Blockchair (API key free tier usually works better via proxy but let's try direct fallback)  
                apis: ['https://api.blockcypher.com/v1/ltc/main', 'https://chain.so/api/v2/get_info/LTC']   
            }  
        ];  
  
        async function initBlockData() {  
            const app = document.getElementById('app');  
            const tasks = COINS.map(async (coin) => {  
                let height = 0, isCached = false;  
                try {  
                    const data = await fetchWithFallback(coin.apis);  
                    // é€‚é…æ ¼å¼  
                    if (typeof data === 'number') height = data; // Plain text/number response  
                    else if (data.height) height = data.height; // BlockCypher  
                    else if (data.data && data.data.blocks) height = data.data.blocks; // Chain.so  
                    localStorage.setItem(coin.id, JSON.stringify({t:Date.now(), v:height}));  
                } catch (e) {  
                    const c = JSON.parse(localStorage.getItem(coin.id));  
                    if (c) { height = c.v; isCached = true; }  
                    else return `<div class="card"><div class="coin-header"><span class="coin-name">${coin.name}</span></div><div style="padding:20px;text-align:center;color:#f85149;">èŠ‚ç‚¹åŒæ­¥ä¸­...</div></div>`;  
                }  
  
                let left = Math.max(0, coin.halving - height);  
                let sec = left * coin.time;  
                let date = new Date(Date.now() + sec * 1000).toLocaleString('zh-CN', {year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit', hour12:false});  
                let prog = Math.min(100, Math.max(0, ((height - coin.last) / (coin.halving - coin.last)) * 100));  
                let cacheTag = isCached ? `<span class="cache-badge" style="display:inline-block">ç¼“å­˜</span>` : '';  
  
                return `  
                    <div class="card ${coin.id}">  
                        <div class="coin-header">  
                            <span class="coin-name">${coin.name}</span>  
                            <div>$${cacheTag}<span class="coin-symbol">$${coin.symbol}</span></div>  
                        </div>  
                        <div class="info-row"><span class="label">å½“å‰é«˜åº¦:</span><span style="font-family:monospace;color:#e6edf3">#${height.toLocaleString()}</span></div>  
                        <div class="info-row"><span class="label">å‡åŠé«˜åº¦:</span><span style="font-family:monospace;color:#e6edf3">#${coin.halving.toLocaleString()}</span></div>  
                        <div class="progress-container"><div class="progress-bar" style="width:$${prog}%; background-color:var(--$${coin.id})"></div></div>  
                        <div style="text-align:right;font-size:12px;color:#8b949e;margin-top:5px;">${prog.toFixed(2)}%</div>  
                        <div class="countdown-box">  
                            <div style="color:#8b949e;font-size:0.9rem">é¢„è®¡å‡åŠå€’è®¡æ—¶</div>  
                            <div class="timer" style="color:var(--text-highlight)">$${Math.floor(sec/86400)}å¤© $${Math.floor((sec%86400)/3600)}æ—¶</div>  
                            <div style="color:#8b949e;font-size:0.85rem">é¢„è®¡: ${date}</div>  
                        </div>  
                    </div>`;  
            });  
            const res = await Promise.all(tasks);  
            app.innerHTML = res.join('');  
        }  
  
        let loading = false;  
        async function manualRefresh() {  
            if (loading) return; loading = true;  
            const btn = document.querySelector('.refresh-btn');  
            const txt = btn.innerText; btn.innerText = "ğŸ“¡ æœç´¢å¯ç”¨èŠ‚ç‚¹..."; btn.disabled = true;  
            updateDateInfo(); await Promise.all([updatePriceGap(), initBlockData()]);  
            btn.innerText = txt; btn.disabled = false; loading = false;  
        }  
  
        updateDateInfo(); updatePriceGap(); initBlockData();  
        setInterval(() => { if(!document.hidden) manualRefresh(); }, 600000);  
    </script>  
</body>  
</html>  
